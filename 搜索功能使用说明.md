# 搜索功能使用说明

## 功能概述

已为 iSperm Medical 网站实现完整的富媒体搜索功能，支持搜索产品、文章、图片和页面。

## 已实现的功能

### 1. 搜索入口
- ✅ 导航栏搜索图标（右上角）
- ✅ 键盘快捷键支持：`Ctrl/Cmd + K` 打开搜索
- ✅ `ESC` 键关闭搜索

### 2. 搜索功能
- ✅ 实时搜索（300ms 防抖）
- ✅ 多类型搜索：产品、文章、图片、页面
- ✅ 搜索结果分类展示
- ✅ 关键词高亮显示
- ✅ 图片预览
- ✅ 多语言支持（18种语言）

### 3. 搜索结果页面
- ✅ 独立搜索结果页面 (`/search?q=查询词`)
- ✅ 友好的空结果提示
- ✅ 加载状态显示

## 文件结构

```
isperm-website/
├── lib/search/
│   ├── types.ts              # 搜索类型定义
│   └── search.ts              # 搜索核心逻辑
├── components/
│   ├── SearchBar.tsx          # 搜索栏组件
│   ├── SearchModal.tsx        # 搜索模态框
│   └── SearchResults.tsx      # 搜索结果展示
├── app/[locale]/search/
│   └── page.tsx               # 搜索结果页面
├── scripts/
│   └── build-search-index.ts  # 索引构建脚本
├── public/search-index/
│   └── [locale].json          # 搜索索引文件（构建时生成）
└── messages/[locale]/
    └── search.json            # 搜索翻译文件
```

## 使用步骤

### 1. 安装依赖

```bash
npm install
```

这会安装 `tsx` 用于运行 TypeScript 脚本。

### 2. 构建搜索索引

在构建网站之前，需要先生成搜索索引：

```bash
npm run build:search-index
```

这会为所有 18 种语言生成搜索索引文件，保存在 `public/search-index/` 目录下。

### 3. 构建网站

```bash
npm run build
```

构建脚本会自动先运行索引构建，然后构建 Next.js 应用。

### 4. 开发模式

开发模式下，搜索功能可以直接使用。但建议先运行一次索引构建：

```bash
npm run build:search-index
npm run dev
```

## 搜索索引更新

当以下内容发生变化时，需要重新构建搜索索引：

- 添加/修改产品信息
- 添加/修改 FAQ 文章
- 添加/修改页面内容
- 添加/修改图片 alt 文本

运行 `npm run build:search-index` 重新生成索引。

## 多语言支持

### 当前状态
- ✅ 英文翻译文件已创建 (`messages/en/search.json`)
- ⚠️ 其他 17 种语言的翻译文件需要创建

### 添加其他语言翻译

为每种语言创建 `messages/[locale]/search.json` 文件，参考英文版本的结构：

```json
{
  "placeholder": "...",
  "startTyping": "...",
  "noResults": "...",
  "tryDifferentQuery": "...",
  "searching": "...",
  "error": "...",
  "shortcutHint": "...",
  "resultsCount": "Found {count} results",
  "pageTitle": "...",
  "searchingFor": "...",
  "enterQuery": "...",
  "foundResults": "Found {count} results for \"{query}\"",
  "types": {
    "product": "...",
    "article": "...",
    "image": "...",
    "page": "..."
  },
  "footer": {
    "company": "...",
    "description": "...",
    "quickLinks": "...",
    "contact": "...",
    "email": "...",
    "rights": "..."
  }
}
```

## 搜索算法

搜索使用简单的文本匹配算法：

1. **精确匹配** - 最高优先级（1.0）
2. **开头匹配** - 高优先级（0.9）
3. **包含匹配** - 中优先级（0.5-0.7，基于位置）
4. **单词匹配** - 低优先级（0.5）

相关性分数计算：
- 标题匹配：40% 权重
- 描述匹配：30% 权重
- 内容匹配：20% 权重
- Alt 文本匹配：10% 权重

## 性能优化

- ✅ 防抖处理（300ms）
- ✅ 索引文件按语言分离
- ✅ 搜索结果限制（最多 50 条）
- ✅ 按相关性排序
- ✅ 客户端搜索（无需服务器）

## 后续增强建议

1. **搜索建议/自动完成**
   - 基于历史搜索
   - 基于热门搜索

2. **高级搜索**
   - 按类型筛选
   - 按分类筛选（人类/兽医）

3. **搜索历史**
   - 本地存储最近搜索
   - 快速访问历史

4. **视觉搜索**
   - 图片相似度匹配
   - AI 图像识别

5. **搜索分析**
   - 记录搜索统计
   - 优化搜索算法

## 故障排查

### 搜索没有结果

1. 检查索引文件是否存在：`public/search-index/[locale].json`
2. 运行 `npm run build:search-index` 重新生成索引
3. 检查浏览器控制台是否有错误

### 搜索索引构建失败

1. 检查翻译文件是否完整
2. 检查 TypeScript 编译错误
3. 确保所有必需的文件存在

### 翻译不显示

1. 检查 `messages/[locale]/search.json` 是否存在
2. 检查 JSON 语法是否正确
3. 检查键名是否与英文版本一致

## 技术支持

如有问题，请检查：
- 控制台错误信息
- 网络请求（索引文件加载）
- 构建日志

---

**文档版本**: v1.0  
**创建日期**: 2024  
**最后更新**: 2024
