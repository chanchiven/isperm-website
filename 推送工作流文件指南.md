# 推送工作流文件到 GitHub 指南

## 问题

在 GitHub Pages 设置中找不到 "Deploy to GitHub Pages" 工作流，需要将工作流文件推送到 GitHub。

## 快速解决方案

### 方法 1: 使用命令行（推荐）

在项目根目录（`f:\Git Pages\isperm-website`）打开 PowerShell 或命令提示符，执行：

```powershell
# 1. 进入项目目录
cd "f:\Git Pages\isperm-website"

# 2. 检查工作流文件是否存在
ls .github/workflows/deploy.yml

# 3. 检查 Git 状态
git status

# 4. 添加工作流文件（如果未跟踪）
git add .github/workflows/deploy.yml

# 5. 如果还有其他未提交的文件（如 .nojekyll），也一起添加
git add public/.nojekyll
git add app/page.tsx

# 6. 提交更改
git commit -m "Add GitHub Pages deployment workflow and fix root path redirect"

# 7. 推送到 GitHub
git push origin main
```

---

### 方法 2: 如果文件已存在但未推送

如果文件已经在本地但未推送到 GitHub：

```powershell
# 1. 检查远程仓库
git remote -v

# 2. 如果还没有设置远程仓库，添加它（替换 YOUR_USERNAME 和 REPO_NAME）
git remote add origin https://github.com/YOUR_USERNAME/REPO_NAME.git

# 3. 推送到 GitHub
git push -u origin main
```

---

### 方法 3: 如果遇到推送错误

如果推送时遇到错误：

```powershell
# 1. 先拉取远程更改（如果有）
git pull origin main --rebase

# 2. 解决冲突（如果有）
# 编辑冲突文件，然后：
git add .
git commit -m "Resolve conflicts"

# 3. 再次推送
git push origin main
```

---

## 完整操作步骤

### 步骤 1: 确认文件存在

```powershell
cd "f:\Git Pages\isperm-website"
ls .github/workflows/deploy.yml
```

**应该看到：** `deploy.yml` 文件存在

---

### 步骤 2: 检查 Git 状态

```powershell
git status
```

**可能的情况：**

**情况 A: 文件未跟踪（显示为红色）**
```
Untracked files:
  .github/workflows/deploy.yml
```
→ 需要添加并提交

**情况 B: 文件已修改（显示为红色）**
```
Changes not staged for commit:
  modified: .github/workflows/deploy.yml
```
→ 需要添加并提交

**情况 C: 文件已暂存（显示为绿色）**
```
Changes to be committed:
  new file: .github/workflows/deploy.yml
```
→ 可以直接提交

**情况 D: 文件已提交但未推送**
```
Your branch is ahead of 'origin/main' by X commits
```
→ 需要推送

---

### 步骤 3: 添加文件到 Git

```powershell
# 添加工作流文件
git add .github/workflows/deploy.yml

# 同时添加其他重要文件（如果存在）
git add public/.nojekyll
git add app/page.tsx
```

---

### 步骤 4: 提交更改

```powershell
git commit -m "Add GitHub Pages deployment workflow"
```

**或者更详细的提交信息：**
```powershell
git commit -m "Add GitHub Pages deployment workflow

- Add deploy.yml workflow for automatic deployment
- Add .nojekyll to disable Jekyll processing
- Add app/page.tsx for root path redirect"
```

---

### 步骤 5: 推送到 GitHub

```powershell
git push origin main
```

**如果是第一次推送：**
```powershell
git push -u origin main
```

---

### 步骤 6: 验证推送成功

1. **在 GitHub 上检查：**
   - 进入您的 GitHub 仓库
   - 点击 `.github` 文件夹
   - 点击 `workflows` 文件夹
   - 应该能看到 `deploy.yml` 文件

2. **在 Actions 标签检查：**
   - 进入仓库的 **Actions** 标签
   - 应该能看到 "Deploy to GitHub Pages" 工作流
   - 可能已经自动触发运行

3. **在 Pages 设置检查：**
   - 进入 **Settings** > **Pages**
   - 点击 "Browse all workflows"
   - 现在应该能看到 "Deploy to GitHub Pages" 工作流

---

## 如果仍然找不到工作流

### 检查 1: 确认文件路径正确

工作流文件必须在以下路径：
```
.github/workflows/deploy.yml
```

**验证：**
```powershell
# Windows PowerShell
Test-Path ".github\workflows\deploy.yml"

# 应该返回 True
```

---

### 检查 2: 确认文件内容正确

打开 `.github/workflows/deploy.yml`，确认文件内容包含：

```yaml
name: Deploy to GitHub Pages
```

**如果文件内容不对，使用我提供的正确内容。**

---

### 检查 3: 等待 GitHub 识别

推送后，GitHub 可能需要 10-30 秒来识别新的工作流文件。

**操作：**
1. 等待 30 秒
2. 刷新 GitHub Pages 设置页面
3. 再次点击 "Browse all workflows"

---

### 检查 4: 手动触发工作流

如果工作流已存在但未显示：

1. 进入 **Actions** 标签
2. 在左侧工作流列表中查找 "Deploy to GitHub Pages"
3. 如果存在，点击进入
4. 点击 **Run workflow** 手动触发一次

---

## 常见错误和解决方案

### 错误 1: "fatal: not a git repository"

**原因：** 当前目录不是 Git 仓库

**解决：**
```powershell
# 初始化 Git 仓库
git init

# 添加远程仓库
git remote add origin https://github.com/YOUR_USERNAME/REPO_NAME.git
```

---

### 错误 2: "fatal: remote origin already exists"

**原因：** 远程仓库已存在

**解决：**
```powershell
# 查看现有远程仓库
git remote -v

# 如果需要更新 URL
git remote set-url origin https://github.com/YOUR_USERNAME/REPO_NAME.git
```

---

### 错误 3: "error: failed to push some refs"

**原因：** 远程仓库有新的提交

**解决：**
```powershell
# 先拉取远程更改
git pull origin main --rebase

# 然后推送
git push origin main
```

---

### 错误 4: "Permission denied"

**原因：** 没有推送权限或认证失败

**解决：**
```powershell
# 使用 HTTPS（会提示输入用户名和密码/Token）
git remote set-url origin https://github.com/YOUR_USERNAME/REPO_NAME.git

# 或使用 SSH（需要配置 SSH 密钥）
git remote set-url origin git@github.com:YOUR_USERNAME/REPO_NAME.git
```

---

## 一键推送脚本

如果您想一次性完成所有操作，可以使用以下脚本：

**PowerShell 脚本：**
```powershell
# 进入项目目录
cd "f:\Git Pages\isperm-website"

# 检查文件
Write-Host "检查工作流文件..." -ForegroundColor Yellow
if (Test-Path ".github\workflows\deploy.yml") {
    Write-Host "✓ 工作流文件存在" -ForegroundColor Green
} else {
    Write-Host "✗ 工作流文件不存在！" -ForegroundColor Red
    exit
}

# 添加文件
Write-Host "`n添加文件到 Git..." -ForegroundColor Yellow
git add .github/workflows/deploy.yml
if (Test-Path "public\.nojekyll") {
    git add public/.nojekyll
    Write-Host "✓ 已添加 .nojekyll" -ForegroundColor Green
}
if (Test-Path "app\page.tsx") {
    git add app/page.tsx
    Write-Host "✓ 已添加 page.tsx" -ForegroundColor Green
}

# 提交
Write-Host "`n提交更改..." -ForegroundColor Yellow
git commit -m "Add GitHub Pages deployment workflow and fixes"

# 推送
Write-Host "`n推送到 GitHub..." -ForegroundColor Yellow
git push origin main

Write-Host "`n✓ 完成！等待 30 秒后刷新 GitHub Pages 设置页面" -ForegroundColor Green
```

**使用方法：**
1. 将上述脚本保存为 `push-workflow.ps1`
2. 在 PowerShell 中执行：`.\push-workflow.ps1`

---

## 验证清单

推送完成后，检查：

- [ ] `.github/workflows/deploy.yml` 文件在 GitHub 仓库中存在
- [ ] 进入 **Actions** 标签，能看到 "Deploy to GitHub Pages" 工作流
- [ ] 进入 **Settings** > **Pages** > "Browse all workflows"，能看到 "Deploy to GitHub Pages"
- [ ] 工作流可以手动触发或自动运行

---

## 总结

**关键步骤：**
1. ✅ 确认 `.github/workflows/deploy.yml` 文件存在
2. ✅ 执行 `git add .github/workflows/deploy.yml`
3. ✅ 执行 `git commit -m "Add deployment workflow"`
4. ✅ 执行 `git push origin main`
5. ✅ 等待 30 秒后刷新 GitHub Pages 设置页面

**预期结果：**
- 在 "Browse all workflows" 中能看到 "Deploy to GitHub Pages"
- 可以选择它作为部署源
- 网站可以正常部署

---

**创建时间：** 2024年12月  
**状态：** ✅ 指南已创建
