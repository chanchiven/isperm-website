# 搜索历史功能 - 快速测试步骤

## 🚀 开发服务器已启动

开发服务器正在后台运行，访问地址通常是：
- **本地地址**: http://localhost:3000
- **网络地址**: http://[你的IP]:3000

---

## 📋 快速测试步骤

### 步骤 1: 打开网站

1. 在浏览器中打开 `http://localhost:3000`
2. 等待页面加载完成

### 步骤 2: 测试搜索历史保存

1. **点击搜索图标**（导航栏右上角）或按 `Ctrl/Cmd + K`
2. **输入搜索词**，例如：
   - "Nexus"
   - "CASA"
   - "WHO"
3. **等待搜索结果出现**
4. **关闭搜索框**（点击外部或按 ESC）

### 步骤 3: 查看搜索历史

1. **再次打开搜索框**（不输入任何内容）
2. **应该看到**：
   - "最近搜索"标题
   - 刚才搜索的记录列表
   - 每条记录显示：
     - 时钟图标
     - 搜索关键词
     - 搜索结果数量（如 "5 results"）
     - 删除按钮（X）

### 步骤 4: 测试使用历史搜索

1. **点击任意一条历史记录**
2. **应该看到**：
   - 搜索框自动填充该关键词
   - 自动执行搜索
   - 显示搜索结果

### 步骤 5: 测试删除功能

1. **点击历史记录右侧的 X 按钮**
2. **应该看到**：该条记录立即消失

### 步骤 6: 测试清除功能

1. **点击"清除"按钮**（带垃圾桶图标）
2. **应该看到**：
   - 所有历史记录消失
   - 显示热门搜索（如果没有历史）

### 步骤 7: 测试数据持久化

1. **执行几次搜索**
2. **刷新页面**（F5）
3. **打开搜索框**
4. **应该看到**：历史记录仍然存在

---

## 🔍 浏览器控制台测试

### 方法 1: 使用测试脚本

1. 打开浏览器开发者工具（F12）
2. 切换到"控制台"标签
3. 复制 `快速测试搜索历史.js` 的内容
4. 粘贴到控制台并回车
5. 查看测试结果

### 方法 2: 手动测试

在控制台中执行：

```javascript
// 查看搜索历史
JSON.parse(localStorage.getItem('isperm_search_history'))

// 添加测试数据
localStorage.setItem('isperm_search_history', JSON.stringify([
  { query: 'Test 1', timestamp: Date.now(), resultCount: 10 },
  { query: 'Test 2', timestamp: Date.now() - 1000, resultCount: 5 }
]))

// 清除历史
localStorage.removeItem('isperm_search_history')
```

---

## ✅ 预期结果检查清单

### 基础功能
- [ ] 搜索后自动保存历史
- [ ] 打开搜索框显示历史列表
- [ ] 点击历史记录自动搜索
- [ ] 显示搜索结果数量

### 管理功能
- [ ] 删除单条历史正常
- [ ] 清除所有历史正常
- [ ] 清除后显示热门搜索

### 数据处理
- [ ] 重复搜索合并为一条
- [ ] 重复搜索移到最前面
- [ ] 最多保存 20 条
- [ ] 最多显示 10 条
- [ ] 按时间倒序排列

### 持久化
- [ ] 刷新页面后历史保留
- [ ] 关闭浏览器后历史保留

### 显示优先级
- [ ] 有输入时显示建议（不显示历史）
- [ ] 无输入+有历史时显示历史
- [ ] 无输入+无历史时显示热门搜索

---

## 🐛 如果遇到问题

### 问题 1: 历史记录不显示

**检查**：
1. 打开控制台（F12），查看是否有错误
2. 检查 localStorage：
   ```javascript
   localStorage.getItem('isperm_search_history')
   ```
3. 确认已执行过搜索

### 问题 2: 点击历史记录无反应

**检查**：
1. 查看控制台错误
2. 确认搜索索引文件存在：`public/search-index/[locale].json`
3. 检查网络请求是否成功

### 问题 3: 历史记录不持久化

**检查**：
1. 确认浏览器允许 localStorage
2. 检查是否在隐私模式下（隐私模式可能限制 localStorage）
3. 查看控制台是否有存储错误

---

## 📊 测试数据准备

如果需要快速准备测试数据，在控制台运行：

```javascript
// 准备测试数据
const testData = [
  'Nexus Dx1',
  'CASA system',
  'WHO 6th Edition',
  'Semen analysis',
  'Sperm morphology',
  'MSQA-100',
  'SQA-6100Vet',
  'Human andrology'
].map((query, i) => ({
  query,
  timestamp: Date.now() - i * 60000,
  resultCount: (i + 1) * 3
}));

localStorage.setItem('isperm_search_history', JSON.stringify(testData));
console.log('✅ 测试数据已准备');
```

---

## 🎯 测试重点

1. **功能完整性**：所有功能是否正常工作
2. **用户体验**：交互是否流畅
3. **数据准确性**：历史记录是否正确保存
4. **持久化**：数据是否持久保存
5. **边界情况**：重复搜索、数量限制等

---

**开始测试吧！** 🚀

如果发现任何问题，请记录并告诉我。
