# 如何修复网页到现在的状态

## 文档概述

本文档详细记录了 iSperm 多语言网站从初始状态到当前完整状态的修复过程。这是一个基于 Next.js + next-intl 的多语言网站，支持 18 种语言，包含产品展示、FAQ 知识库、关于我们、联系我们等完整功能。

---

## 项目架构

### 技术栈
- **框架**: Next.js 14+ (App Router)
- **国际化**: next-intl
- **语言支持**: 18 种语言（en, es, ar, de, it, pt, ru, tr, fr, pl, nl, ko, ja, vi, id, uk, bg, ro）
- **样式**: CSS Modules + 内联样式
- **类型**: TypeScript

### 目录结构
```
app/
├── [locale]/          # 多语言路由
│   ├── page.tsx       # 首页
│   ├── about/         # 关于我们
│   ├── products/      # 产品页面
│   ├── faq/          # FAQ 知识库
│   └── contact/      # 联系我们
├── api/              # API 路由
└── middleware.ts     # 中间件（语言路由）

messages/             # 翻译文件
├── en/              # 英文（Source of Truth）
├── es/              # 西班牙语
├── de/              # 德语
└── [其他语言]/

components/          # 组件
├── Navigation.tsx   # 导航栏
├── LanguageSwitcher.tsx  # 语言切换器
└── ...
```

---

## 主要修复内容

### 1. ✅ FAQ 页面结构统一化

#### 问题描述
- FAQ 文章数据分散在两个对象中：`articles`（元数据）和 `FaqArticles`（内容）
- 代码中需要维护复杂的 slug 映射表
- 错误处理不完善，缺少 404 处理

#### 修复方案

**1.1 统一 JSON 结构**
- 将 `articles` 和 `FaqArticles` 合并为统一的 `articles.[slug]` 结构
- 每个文章对象包含完整信息：`title`, `subtitle`, `image`, `alt`, `link`, `intro`, `chapters`, `conclusion`, `references`

**修复前：**
```json
{
  "articles": {
    "humanSemen": { "title": "...", "link": "..." }
  },
  "FaqArticles": {
    "faq-human-semen-standards": { "intro": "...", "chapters": [...] }
  }
}
```

**修复后：**
```json
{
  "articles": {
    "faq-human-semen-standards": {
      "title": "...",
      "subtitle": "...",
      "link": "...",
      "intro": "...",
      "chapters": [...],
      "conclusion": "...",
      "references": [...]
    }
  }
}
```

**1.2 改进错误处理**
- 添加 `VALID_SLUGS` 常量验证
- 在 `generateMetadata` 和页面组件中添加 `notFound()` 调用
- 移除硬编码错误信息，使用翻译键

**1.3 代码更新**
- 移除 `articleSlugMap` 映射表
- 使用统一路径 `articles.${slug}` 访问文章
- 更新列表页面使用新路径结构

**修复文件：**
- `messages/en/faq.json` - 合并结构（备份为 `faq_backup.json`）
- `app/[locale]/faq/[slug]/page.tsx` - 更新访问路径和错误处理
- `app/[locale]/faq/page.tsx` - 更新列表页面
- `components/FAQArticleCard.tsx` - 实现弹性布局组件

**新增内容：**
- 新增 4 篇 FAQ 文章（WHO 6th Edition, ISO 23162:2021, ESHRE Guidelines, ASRM Protocols）
- 所有 17 种语言均已翻译完成

---

### 2. ✅ Footer 地址硬编码修复

#### 问题描述
- 所有页面的 Footer 部分都有硬编码的英文地址
- 地址无法本地化，不支持多语言

#### 修复方案

**2.1 代码修复**
将所有硬编码地址替换为翻译函数：

**修复前：**
```tsx
<p>{t('footer.address')} 2F, Block B, Shenchengtou & Zhongcheng Life Science Park, Pingshan District, Shenzhen, Guangdong, China.</p>
```

**修复后：**
```tsx
<p>{t('footer.address')} {t('footer.fullAddress')}</p>
```

**2.2 翻译文件更新**
在所有相关翻译文件的 `footer` 对象中添加 `fullAddress` 键：
- `messages/en/index.json`
- `messages/en/products.json`
- `messages/en/about.json`
- `messages/en/faq.json`
- `messages/en/contact.json`

**修复的页面（共 9 个）：**
1. `app/[locale]/page.tsx`
2. `app/[locale]/about/page.tsx`
3. `app/[locale]/contact/page.tsx`
4. `app/[locale]/faq/page.tsx`
5. `app/[locale]/faq/[slug]/page.tsx`
6. `app/[locale]/products/page.tsx`
7. `app/[locale]/products/msqa-100/page.tsx`
8. `app/[locale]/products/nexus-dx1/page.tsx`
9. `app/[locale]/products/sqa-6100vet/page.tsx`

---

### 3. ✅ 翻译完整性修复

#### 问题描述
- 部分语言缺少翻译文件
- 部分语言缺少关键翻译键
- JSON 语法错误

#### 修复方案

**3.1 创建缺失文件**
- **越南语 (vi)**: 创建 `messages/vi/about.json` 和 `messages/vi/contact.json`

**3.2 添加缺失键值**

**阿拉伯语 (ar):**
- `about.json` - 添加 `footer.fullAddress`
- `contact.json` - 添加 22 个缺失键值（actionCards, form, trust）
- `index.json` - 添加 `features.aiPowered.compliance`

**德语/意大利语/土耳其语 (de/it/tr):**
- `about.json` - 添加 `footer.fullAddress`

**法语 (fr):**
- `faq.json` - 添加 `errors` 和 `footer` 对象（共 10 个键值）

**保加利亚语 (bg):**
- `faq.json` - 修复 JSON 语法错误

**3.3 清理多余键值**
- 删除不在英文版本中的键值，确保所有语言文件与英文版本完全一致

**修复结果：**
- ✅ 所有 17 种语言翻译完整
- ✅ 所有必需文件齐全
- ✅ 所有键值完整
- ✅ 所有多余键值已清理

---

### 4. ✅ 硬编码文本清理

#### 问题描述
- Contact 页面表单验证错误信息硬编码
- FAQ 文章页错误和占位符文本硬编码
- 邮件主题硬编码
- 无障碍属性硬编码

#### 修复方案

**4.1 Contact 页面表单验证**
- 将验证错误信息添加到翻译文件
- 使用翻译函数替换硬编码文本

**修复前：**
```tsx
newErrors.name = 'Name is required';
newErrors.email = 'Email is required';
```

**修复后：**
```tsx
newErrors.name = t('form.errors.nameRequired');
newErrors.email = t('form.errors.emailRequired');
```

**4.2 FAQ 文章页错误处理**
- 添加 `errors.articleNotFound.title` 和 `errors.articleNotFound.message` 到翻译文件
- 添加 `ui.articlePlaceholder.*` 键值
- 添加 `ui.conclusion.title` 和 `ui.references.title`

**4.3 邮件主题**
- 将邮件主题添加到翻译文件（如需要）

---

### 5. ✅ UI 弹性布局优化

#### 问题描述
- 不同语言的文本长度差异导致布局不对齐
- 卡片高度不一致
- 按钮位置不统一
- 某些语言（如德语、阿拉伯语）文本特别长，导致布局混乱

#### 修复方案

**5.1 FAQArticleCard 组件弹性布局实现**

**位置**: `components/FAQArticleCard.tsx`

**关键特性**:
- ✅ 使用 Flexbox 布局 (`display: 'flex', flexDirection: 'column'`)
- ✅ 卡片容器使用 `alignItems: 'stretch'` 确保高度一致
- ✅ 标题设置了 `minHeight`:
  - 固定图片高度模式: `minHeight: '3.64rem'` (2行文本，使用 `WebkitLineClamp: 2`)
  - 非固定图片高度模式: `minHeight: '4.32rem'`
- ✅ 副标题设置了 `minHeight`:
  - 固定图片高度模式: 使用 `WebkitLineClamp: 3` 限制3行
  - 非固定图片高度模式: `minHeight: '5.5rem'`
- ✅ 内容区域使用 `flex: '1'` 实现弹性填充
- ✅ 支持文本换行和溢出处理 (`overflowWrap`, `wordBreak`, `hyphens`)

**5.2 FAQ 页面 Grid 布局**

**位置**: `app/[locale]/faq/page.tsx`

**关键特性**:
- ✅ 使用 CSS Grid 布局 (`display: 'grid'`)
- ✅ 设置了 `alignItems: 'stretch'` 确保卡片高度一致
- ✅ 响应式列宽设置:
  - Human Andrology 部分: `gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 350px))'`
  - Veterinary Andrology 部分: `gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))'`
- ✅ 适当的间距设置 (`gap: '2rem'`)

**5.3 固定图片高度模式**

对于新增的4篇文章，使用 `fixedImageHeight={true}` 属性:
- ✅ 图片高度固定为 240px，确保视觉一致性
- ✅ 标题限制为2行显示 (`WebkitLineClamp: 2`)
- ✅ 副标题限制为3行显示 (`WebkitLineClamp: 3`)
- ✅ 内容区域最小高度为 180px

**5.4 多语言文本处理**

针对不同语言的文本特性:
- ✅ 支持从左到右 (LTR) 和从右到左 (RTL) 文本方向
- ✅ 文本换行和断词处理 (`overflowWrap: 'break-word'`, `wordBreak: 'break-word'`)
- ✅ 自动连字符 (`hyphens: 'auto'`)
- ✅ 文本溢出处理 (`textOverflow: 'ellipsis'`)

**5.5 全语言 UI 弹性布局审计**

**审计范围**: 已完成对所有 17 种语言的 UI 弹性布局审计

**审计的语言**:
1. 西班牙语 (es)
2. 阿拉伯语 (ar)
3. 德语 (de)
4. 意大利语 (it)
5. 葡萄牙语 (pt)
6. 俄语 (ru)
7. 土耳其语 (tr)
8. 法语 (fr)
9. 波兰语 (pl)
10. 荷兰语 (nl)
11. 韩语 (ko)
12. 日语 (ja)
13. 越南语 (vi)
14. 印尼语 (id)
15. 乌克兰语 (uk)
16. 保加利亚语 (bg)
17. 罗马尼亚语 (ro)

**审计结果**:
- ✅ 所有语言的 FAQArticleCard 组件正确实现弹性布局
- ✅ 所有语言的 FAQ 页面 Grid 布局正确配置
- ✅ 所有新增文章的布局配置正确
- ✅ 文本处理机制能够处理不同语言的文本长度差异
- ✅ 响应式设计在所有语言版本中正常工作

**修复结果：**
- ✅ 所有 17 种语言的卡片布局对齐
- ✅ 按钮位置统一
- ✅ 响应式布局正常
- ✅ 长文本语言（如德语、阿拉伯语）布局稳定
- ✅ 所有语言的视觉一致性得到保证

---

### 6. ✅ Nexus Dx1 产品详情页 "Compliance & Standards" 部分多语言化

#### 问题描述
- Nexus Dx1 产品详情页末尾的 "Compliance & Standards" 部分使用硬编码英文文本
- 标准列表（WHO 6th, ISO 23162, ESHRE, ASRM）硬编码在代码中
- 描述文本使用变量替换，但实现复杂且不可靠
- 不支持多语言切换

#### 修复方案

**6.1 重构 JSON 结构**

将硬编码的标准列表改为从 JSON 读取，使用 `standards` 数组结构：

**修复前（硬编码）：**
```tsx
const complianceArticles = [
  { slug: 'who-6th-edition-semen-analysis-standards', standardName: 'WHO 6th' },
  { slug: 'iso-23162-2021-laboratory-competence-guide', standardName: 'ISO 23162' },
  // ...
];
```

**修复后（JSON 驱动）：**
```json
{
  "complianceStandards": {
    "title": "Compliance & Standards",
    "standards": [
      {
        "slug": "who-6th-edition-semen-analysis-standards",
        "name": "WHO 6th",
        "title": "WHO 6th Guidelines",
        "description": "The <strong>Nexus Dx1</strong> fully complies with <strong>WHO 6th</strong> guidelines. Read our detailed analysis."
      },
      // ...
    ],
    "learnMore": "Learn more →"
  }
}
```

**6.2 代码重构**

- 移除硬编码的 `complianceArticles` 数组
- 移除复杂的变量替换逻辑
- 使用 `t.raw()` 从 JSON 读取 `standards` 数组
- 简化代码，直接使用 JSON 中的数据

**修复前：**
```tsx
const descriptionTemplate = getT('products.nexus.detail.complianceStandards.card.description');
const description = descriptionTemplate
  .replace('{productName}', productName)
  .replace('{standardName}', article.standardName);
```

**修复后：**
```tsx
let standards = t.raw('products.nexus.detail.complianceStandards.standards') as Array<{
  slug: string;
  name: string;
  title: string;
  description: string;
}> | undefined;
// 直接使用 standard.title 和 standard.description
```

**6.3 翻译文件更新**

为所有 18 种语言添加 `complianceStandards` 结构：
- 英文（en）- 作为 Source of Truth
- 日语（ja）
- 印尼语（id）
- 保加利亚语（bg）
- 越南语（vi）
- 乌克兰语（uk）
- 罗马尼亚语（ro）
- 阿拉伯语（ar）
- 德语（de）
- 西班牙语（es）
- 法语（fr）
- 意大利语（it）
- 荷兰语（nl）
- 波兰语（pl）
- 葡萄牙语（pt）
- 土耳其语（tr）
- 俄语（ru）
- 韩语（ko）

**6.4 修复 "Learn more" 翻译丢失问题**

**问题原因：**
- 使用 `namespace: 'products'` 时，next-intl 会在键名前自动添加 namespace
- 验证逻辑未正确识别翻译失败的情况

**修复方案：**
- 改进 `getT` 函数的验证逻辑，检查值是否以 `products.` 开头
- 为 `learnMore` 添加多层回退机制
- 直接使用 `t` 和 `tEn` 函数作为回退

**修复文件：**
- `app/[locale]/products/nexus-dx1/page.tsx` - 重构代码，从 JSON 读取标准列表
- `messages/en/products.json` - 更新 JSON 结构
- `messages/[locale]/products.json` - 为所有 18 种语言添加翻译

**修复结果：**
- ✅ 所有内容从 JSON 读取，完全支持多语言
- ✅ 代码简化，易于维护
- ✅ 所有 18 种语言翻译完成
- ✅ "Learn more" 翻译正常工作

---

### 7. ✅ 主页 Banner 滑动功能冻结

#### 问题描述
- 主页 banner 自动轮播，每 5 秒切换一次图片
- 用户希望固定显示第一张 banner 图片，禁用自动滑动功能

#### 修复方案

**7.1 禁用自动轮播**
- 注释掉主页中的 `useEffect` 轮播逻辑
- Banner 将固定显示第一张图片（`banner (1).webp`）

**修复前：**
```tsx
useEffect(() => {
  const slides = document.querySelectorAll('.carousel-slide');
  let currentIndex = 0;
  const nextSlide = () => {
    currentIndex = (currentIndex + 1) % slides.length;
    showSlide(currentIndex);
  };
  const interval = setInterval(nextSlide, 5000);
  return () => clearInterval(interval);
}, []);
```

**修复后：**
```tsx
// Hero carousel functionality - DISABLED
// useEffect(() => {
//   // ... 轮播代码已注释
// }, []);
```

**修复文件：**
- `app/[locale]/page.tsx` - 注释掉自动轮播的 useEffect

**修复结果：**
- ✅ Banner 不再自动滑动
- ✅ 固定显示第一张图片
- ✅ 其他图片保持隐藏状态

---

### 8. ✅ About 页面 "Our Team & Events" 图片更新

#### 问题描述
- About 页面的 "Our Team & Events" 部分只有 2 张图片
- 需要添加更多团队和活动展示图片

#### 修复方案

**8.1 添加新图片**
在 "Company Showcase Images" 部分添加三张新图片：
- `About Us 2.webp`
- `About Us 4.webp`
- `About Us 5.webp`

**修复前：**
```tsx
<div className="product-images-list">
  <div className="product-image-item">
    <img src="/About%20us%20(1).webp" ... />
  </div>
  <div className="product-image-item">
    <img src="/About%20us%20(2).webp" ... />
  </div>
</div>
```

**修复后：**
```tsx
<div className="product-images-list">
  <div className="product-image-item">
    <img src="/About%20us%20(1).webp" ... />
  </div>
  <div className="product-image-item">
    <img src="/About%20us%20(2).webp" ... />
  </div>
  <div className="product-image-item">
    <img src="/About%20Us%202.webp" ... />
  </div>
  <div className="product-image-item">
    <img src="/About%20Us%204.webp" ... />
  </div>
  <div className="product-image-item">
    <img src="/About%20Us%205.webp" ... />
  </div>
</div>
```

**修复文件：**
- `app/[locale]/about/page.tsx` - 添加三张新图片

**修复结果：**
- ✅ "Our Team & Events" 部分现在有 5 张图片
- ✅ 所有图片添加了适当的 alt 文本
- ✅ 图片使用懒加载优化性能

---

### 9. ✅ Nexus Dx1 产品详情页图片更新

#### 问题描述
- Nexus Dx1 产品详情页只有一张主产品图片（`nexus-dx1.webp`）
- 需要添加更多产品展示图片以增强视觉效果和产品信息展示

#### 修复方案

**9.1 添加新图片**
在产品详情页的图片展示区域添加两张新图片：
- `nexus-dx1-2.webp` - 产品功能展示图片
- `nexus-dx1-3.webp` - 产品应用场景图片

**修复前：**
```tsx
<div className="product-detail-image" style={{maxWidth: '900px', margin: '0 auto', position: 'relative', aspectRatio: '16/9'}}>
  <Image 
    src="/nexus-dx1.webp" 
    alt="..."
    fill
    priority
    quality={85}
    style={{objectFit: 'contain'}}
    sizes="(max-width: 768px) 100vw, 900px"
  />
</div>
```

**修复后：**
```tsx
<div className="product-detail-image">
  <div className="product-images-list">
    <div className="product-image-item" style={{position: 'relative', aspectRatio: '16/9'}}>
      <Image 
        src="/nexus-dx1.webp" 
        alt="..."
        fill
        priority
        quality={85}
        style={{objectFit: 'contain', padding: '1rem'}}
        sizes="(max-width: 768px) 100vw, (max-width: 968px) 50vw, 33vw"
      />
    </div>
    <div className="product-image-item" style={{position: 'relative', aspectRatio: '16/9'}}>
      <Image 
        src="/nexus-dx1-2.webp" 
        alt="..."
        fill
        quality={85}
        style={{objectFit: 'contain', padding: '1rem'}}
        sizes="(max-width: 768px) 100vw, (max-width: 968px) 50vw, 33vw"
      />
    </div>
    <div className="product-image-item" style={{position: 'relative', aspectRatio: '16/9'}}>
      <Image 
        src="/nexus-dx1-3.webp" 
        alt="..."
        fill
        quality={85}
        style={{objectFit: 'contain', padding: '1rem'}}
        sizes="(max-width: 768px) 100vw, (max-width: 968px) 50vw, 33vw"
      />
    </div>
  </div>
</div>
```

**9.2 布局改进**
- 将单个图片展示改为图片网格布局（`product-images-list`）
- 使用响应式网格布局，适配不同屏幕尺寸
- 大屏幕多列显示，小屏幕单列显示
- 保持与其他产品详情页（如 `sqa-6100vet`）的布局一致性

**修复文件：**
- `app/[locale]/products/nexus-dx1/page.tsx` - 更新图片展示区域为网格布局，添加两张新图片

**修复结果：**
- ✅ Nexus Dx1 产品详情页现在有 3 张产品图片
- ✅ 使用响应式网格布局，适配不同屏幕尺寸
- ✅ 所有图片添加了描述性的 alt 文本
- ✅ 布局与其他产品详情页保持一致
- ✅ 图片使用适当的尺寸和质量设置以优化性能

---

### 10. ✅ 导航和链接修复

#### 问题描述
- 语言切换后链接跳转到英文版本
- Link 组件未传递 locale 参数

#### 修复方案

**7.1 使用 next-intl 的 Link 组件**
```tsx
import {Link} from '@/i18n/routing';
import {useLocale} from 'next-intl';

const locale = useLocale();
<Link href="/products" locale={locale as any}>
  {t('nav.products')}
</Link>
```

**7.2 创建客户端导航组件**
- 导航栏必须使用客户端组件（`'use client'`）
- 使用 `useLocale()` hook 获取当前语言
- 所有链接显式传递 `locale` 参数

**修复文件：**
- `components/Navigation.tsx` - 更新为客户端组件
- 所有页面的 Footer 链接
- Breadcrumb 导航链接

---

## 修复步骤详解

### 步骤 1: 环境准备

1. **检查项目依赖**
```bash
npm install
```

2. **验证 Next.js 配置**
- 检查 `next.config.js`
- 检查 `i18n/routing.ts` 配置

3. **验证翻译文件结构**
- 确保 `messages/en/` 目录下所有文件完整
- 验证 JSON 语法正确

---

### 步骤 2: 翻译文件修复

#### 2.1 检查翻译完整性
```bash
node check-translations.js
```

#### 2.2 修复缺失文件
1. 复制英文版本作为模板
2. 翻译内容
3. 验证 JSON 语法

#### 2.3 修复缺失键值
1. 对比英文版本和待修复语言版本
2. 添加缺失的键值对
3. 确保键名与英文版本完全一致

#### 2.4 清理多余键值
1. 识别不在英文版本中的键
2. 删除多余键值
3. 验证 JSON 语法

---

### 步骤 3: 代码修复

#### 3.1 移除硬编码文本
1. 搜索硬编码文本（使用 grep 或 IDE 搜索）
2. 在翻译文件中添加对应键值
3. 替换硬编码为翻译函数

#### 3.2 修复链接和导航
1. 检查所有 Link 组件
2. 确保传递 `locale` 参数
3. 更新导航组件为客户端组件

#### 3.3 改进错误处理
1. 添加 `notFound()` 导入
2. 添加验证逻辑
3. 使用翻译键替换硬编码错误信息

---

### 步骤 4: UI 布局优化

#### 4.1 分析文本长度差异
1. 测试不同语言的页面显示
2. 识别布局问题
3. 记录需要调整的组件

#### 4.2 应用弹性布局
1. 使用 Flexbox/Grid 布局
2. 设置合理的 `minHeight`
3. 确保按钮对齐

#### 4.3 响应式测试
1. 测试不同屏幕尺寸
2. 验证移动端布局
3. 调整断点和样式

---

### 步骤 5: 验证和测试

#### 5.1 功能测试
- [ ] 所有页面能正常加载
- [ ] 语言切换功能正常
- [ ] 所有链接保留语言
- [ ] 表单提交功能正常
- [ ] 404 页面正常显示

#### 5.2 翻译测试
- [ ] 所有语言页面正常显示
- [ ] 无翻译键显示（如 `contact.footer.fullAddress`）
- [ ] 所有文本正确翻译
- [ ] Meta 标签正确

#### 5.3 视觉测试
- [ ] 文本对齐正确
- [ ] 卡片布局一致
- [ ] 按钮位置统一
- [ ] 响应式布局正常
- [ ] 长文本语言（德语、阿拉伯语等）布局稳定
- [ ] FAQ 文章卡片在所有语言中高度一致

#### 5.4 SEO 测试
- [ ] 页面 Title 正确
- [ ] Meta Description 正确
- [ ] 所有语言的 URL 可访问
- [ ] 图片 ALT 文本正确

---

## 核心修复原则

### 1. Source of Truth 原则
- **英文（en）是唯一标准源**
- 所有翻译文件结构必须与 `messages/en/` 完全一致
- 新增翻译键时，必须先更新英文版本

### 2. 键名不变原则
- **键名（Key）永远不变**
- JSON 文件的键名必须与英文版本严格对应
- 只翻译值（Value），不改变键名（Key）

### 3. 链接传递 locale 原则
- **所有内部链接必须传递 locale**
- 使用 `next-intl` 的 Link 组件
- 显式传递 `locale={locale as any}` 参数

### 4. 客户端组件原则
- 导航栏必须使用客户端组件
- 使用 `useTranslations` hook 获取翻译
- 使用 `useLocale()` hook 获取当前语言

---

## 工具和脚本

### 1. 翻译检查脚本
```bash
node check-translations.js
```
- 检查所有语言是否有必需的文件
- 检查每个文件的键值是否完整
- 报告缺失的文件和键值
- 报告多余的键值（警告）

### 2. JSON 验证工具
- [JSONLint](https://jsonlint.com/) - 在线 JSON 验证
- VS Code JSON 插件 - 实时验证

### 3. 开发工具
- Next.js Dev Tools - 开发调试
- React DevTools - 组件调试
- Browser DevTools - 网络和性能分析

---

## 常见问题和解决方案

### 问题 1: 翻译键显示为键名

**症状**: 页面上显示 `contact.footer.fullAddress` 而不是实际地址

**原因**: 翻译键位置错误，代码使用 `t('footer.fullAddress')` 但 JSON 中键在 `contact.fullAddress`

**解决**: 确保键的位置与代码中使用的路径一致

---

### 问题 2: 语言切换后跳转到英文

**症状**: 点击语言切换器后，页面跳转到英文版本

**原因**: 
1. Link 组件未传递 `locale` 参数
2. 使用了服务端组件的 `t` 函数传递给客户端组件

**解决**: 
1. 所有 Link 组件显式传递 `locale={locale as any}`
2. 创建客户端组件，使用 `useTranslations` hook

---

### 问题 3: 文本对齐问题

**症状**: 不同语言的文本长度导致布局不对齐

**原因**: 未使用弹性布局，固定高度或间距

**解决**: 
1. 使用 Flexbox 和 Grid 布局
2. 设置合理的 `minHeight`
3. 使用 `flex: 1` 让内容区域自适应

---

### 问题 4: JSON 语法错误

**症状**: 页面无法加载，控制台显示 JSON 解析错误

**原因**: 
1. 多余逗号
2. 括号不匹配
3. 引号未转义

**解决**: 
1. 使用 JSON 验证工具检查
2. 分块翻译避免文件过大
3. 每次保存后验证 JSON 语法

---

## 修复完成清单

### ✅ 已完成项目

- [x] FAQ 页面结构统一化
- [x] Footer 地址硬编码修复（9 个页面）
- [x] 翻译完整性修复（17 种语言）
- [x] 硬编码文本清理
- [x] UI 弹性布局优化
- [x] 导航和链接修复
- [x] 错误处理改进
- [x] SEO Meta 标签翻译
- [x] 图片 ALT 文本翻译
- [x] 响应式布局优化
- [x] Nexus Dx1 产品详情页 "Compliance & Standards" 部分多语言化
- [x] 主页 Banner 滑动功能冻结
- [x] About 页面 "Our Team & Events" 图片更新
- [x] Nexus Dx1 产品详情页图片更新（新增 2 张产品图片）

### 📊 修复统计

- **修复的页面数量**: 11 个页面（新增 Nexus Dx1 产品详情页、主页 Banner 冻结、About 页面图片更新、Nexus Dx1 产品详情页图片更新）
- **修复的翻译文件**: 18 种语言 × 5 个文件 = 90 个文件（新增 18 个 products.json 文件的 complianceStandards 部分）
- **修复的硬编码文本**: 20+ 处（新增 Compliance & Standards 部分）
- **添加的翻译键**: 120+ 个（新增每个语言的 4 个标准 + 标题 + learnMore）
- **修复的 JSON 语法错误**: 多个
- **UI 弹性布局审计**: 18 种语言全部完成
- **FAQ 新增文章**: 4 篇文章（WHO 6th Edition, ISO 23162:2021, ESHRE Guidelines, ASRM Protocols）
- **产品详情页多语言化**: Nexus Dx1 的 Compliance & Standards 部分（18 种语言）
- **主页 Banner**: 已冻结自动滑动功能
- **About 页面图片**: 新增 3 张团队和活动展示图片
- **产品详情页图片**: Nexus Dx1 新增 2 张产品展示图片（共 3 张图片，使用响应式网格布局）

---

## 最佳实践总结

### 1. 翻译工作流程
1. 选择目标语言
2. 创建/更新翻译文件
3. 分块翻译（不要一次性翻译大文件）
4. 验证 JSON 语法
5. 更新路由配置（如需要）
6. 视觉审计
7. 修复问题，重复测试

### 2. 代码规范
- 所有文本使用翻译函数
- 所有链接传递 locale
- 导航栏使用客户端组件
- 错误处理使用翻译键

### 3. UI 设计
- 使用弹性布局（Flexbox/Grid）
- 设置合理的 `minHeight`
- 确保按钮对齐
- 测试响应式布局

### 4. 质量控制
- 定期运行翻译检查脚本
- 验证 JSON 语法
- 测试所有语言页面
- 检查 SEO Meta 标签
- 进行 UI 弹性布局审计（针对每种语言）
- 验证长文本语言的布局稳定性
- 测试响应式布局在不同设备上的表现

---

## 维护建议

### 1. 新增语言流程
1. 在 `i18n/routing.ts` 中添加新语言
2. 在 `components/LanguageSwitcher.tsx` 中添加语言选项
3. 创建 `messages/[locale]/` 目录
4. 翻译所有 JSON 文件
5. 验证 JSON 语法
6. 测试所有页面

### 2. 新增内容流程

#### 2.1 新增翻译键
1. 先在英文版本中添加翻译键
2. 同步到其他语言
3. 更新代码使用新键
4. 测试所有语言

#### 2.2 新增 FAQ 文章
1. 在 `messages/en/faq.json` 的 `articles` 对象中添加新文章
2. 文章结构包含：`title`, `subtitle`, `image`, `alt`, `link`, `intro`, `chapters`, `conclusion`, `references`
3. 使用完整的 slug 作为键名（如 `faq-who-6th-edition-standards`）
4. 翻译到所有 17 种语言
5. 在 `app/[locale]/faq/page.tsx` 中添加文章卡片
6. 配置 `fixedImageHeight` 属性以保持布局一致性
7. 进行 UI 弹性布局审计
8. 测试所有语言版本的显示效果

### 3. 定期检查
- 每月运行翻译检查脚本
- 检查硬编码文本
- 验证链接 locale 传递
- 测试语言切换功能
- 检查 UI 弹性布局在新语言中的表现
- 验证响应式布局在不同设备上的兼容性
- 检查新增内容的翻译完整性

---

## 参考文档

- [多语言开发与翻译准则.md](./多语言开发与翻译准则.md) - 详细的开发规范
- [FAQ修复完成总结.md](./FAQ修复完成总结.md) - FAQ 修复详情
- [FAQ修复完成报告.md](./FAQ修复完成报告.md) - FAQ 修复报告
- [FAQ文章页面检查报告.md](./FAQ文章页面检查报告.md) - FAQ 文章页检查详情
- [Footer地址修复完成报告.md](./Footer地址修复完成报告.md) - Footer 修复详情
- [翻译完整性检查报告.md](./翻译完整性检查报告.md) - 翻译完整性详情
- [硬编码文本检查报告.md](./硬编码文本检查报告.md) - 硬编码文本详情
- [产品详情页检查报告.md](./产品详情页检查报告.md) - 产品页检查详情
- [翻译键检查报告.md](./翻译键检查报告.md) - 翻译键检查详情
- [UI_弹性布局审计报告_*.md](./UI_弹性布局审计报告_*.md) - 17 种语言的 UI 弹性布局审计报告

---

## 文档版本

- **版本**: 1.4
- **创建日期**: 2024
- **最后更新**: 2024年12月
- **维护者**: 开发团队

### 版本历史

- **v1.4** (2024年12月)
  - 添加 Nexus Dx1 产品详情页图片更新详情
  - 更新产品详情页图片展示为响应式网格布局
  - 更新修复统计信息（新增产品详情页图片更新）
  - 更新已完成项目清单

- **v1.3** (2024年12月)
  - 添加主页 Banner 滑动功能冻结修复详情
  - 添加 About 页面 "Our Team & Events" 图片更新详情
  - 更新修复统计信息（新增 Banner 冻结和图片更新）
  - 更新已完成项目清单

- **v1.2** (2024年12月)
  - 添加 Nexus Dx1 产品详情页 "Compliance & Standards" 部分多语言化修复详情
  - 更新修复统计信息（18种语言，新增产品详情页）
  - 添加翻译丢失问题修复说明
  - 更新已完成项目清单

- **v1.1** (2024年12月)
  - 添加 UI 弹性布局审计详情（17种语言）
  - 更新修复统计信息
  - 完善 FAQArticleCard 组件说明
  - 添加 FAQ 新增文章信息
  - 更新参考文档列表

- **v1.0** (2024年)
  - 初始版本
  - 记录所有主要修复内容

---

**重要提醒**: 本文档记录了从初始状态到当前完整状态的修复过程。在进行新的修复或添加新功能时，请参考本文档和《多语言开发与翻译准则.md》，确保遵循既定的规范和最佳实践。

