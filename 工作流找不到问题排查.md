# GitHub Pages 找不到工作流问题排查

## 问题描述

`deploy.yml` 文件已经上传到代码库，但在 GitHub Pages 设置中找不到 "Deploy to GitHub Pages" 工作流。

## 可能的原因和解决方案

### 原因 1: GitHub 需要时间识别工作流 ⏰

**问题：** GitHub 可能需要几分钟来识别新的工作流文件。

**解决方案：**
1. **等待 2-5 分钟**
2. **刷新 GitHub Pages 设置页面**（按 F5 或 Ctrl+R）
3. **再次点击 "Browse all workflows"**

---

### 原因 2: 工作流从未运行过 🚫

**问题：** GitHub Pages 设置可能只显示**已经运行过**的工作流。

**解决方案：手动触发工作流**

1. **进入 Actions 标签**
   - 在 GitHub 仓库页面，点击 **Actions** 标签

2. **查找工作流**
   - 在左侧工作流列表中，查找 **"Deploy to GitHub Pages"**
   - 如果能看到，点击进入

3. **手动触发**
   - 点击右上角的 **"Run workflow"** 按钮
   - 选择分支（通常是 `main`）
   - 点击 **"Run workflow"**

4. **等待运行完成**
   - 等待工作流运行完成（1-3 分钟）
   - 运行成功后，刷新 GitHub Pages 设置页面

---

### 原因 3: GitHub Actions 未启用 🔧

**问题：** 仓库可能禁用了 GitHub Actions。

**解决方案：启用 GitHub Actions**

1. **进入仓库设置**
   - 点击 **Settings**（设置）

2. **检查 Actions 设置**
   - 在左侧菜单找到 **Actions** → **General**
   - 查看 **"Workflow permissions"** 部分
   - 确保选择了 **"Read and write permissions"** 或 **"Read repository contents and packages permissions"**

3. **检查 Actions 是否启用**
   - 在 **Actions** → **General** 中
   - 确保 **"Allow all actions and reusable workflows"** 已启用
   - 或者至少允许 **"Allow local actions and reusable workflows"**

---

### 原因 4: 工作流文件格式问题 📝

**问题：** 工作流文件可能有语法错误或格式问题。

**解决方案：检查工作流文件**

1. **在 GitHub 上查看文件**
   - 进入仓库
   - 点击 `.github` 文件夹
   - 点击 `workflows` 文件夹
   - 点击 `deploy.yml` 文件
   - 检查文件内容是否正确显示

2. **检查 Actions 标签是否有错误**
   - 进入 **Actions** 标签
   - 查看是否有红色错误标记
   - 如果有，点击查看错误详情

3. **验证 YAML 语法**
   - 确保文件使用正确的 YAML 格式
   - 缩进使用空格（不是 Tab）
   - 确保所有引号匹配

---

### 原因 5: 工作流文件路径不正确 📁

**问题：** 文件可能不在正确的位置。

**解决方案：确认文件路径**

工作流文件必须在以下路径：
```
.github/workflows/deploy.yml
```

**在 GitHub 上验证：**
1. 进入仓库根目录
2. 应该能看到 `.github` 文件夹
3. 点击进入，应该能看到 `workflows` 文件夹
4. 点击进入，应该能看到 `deploy.yml` 文件

**如果路径不对：**
- 文件必须在 `.github/workflows/` 目录下
- 文件名可以是 `deploy.yml` 或任何 `.yml`/`.yaml` 结尾的文件

---

### 原因 6: 权限问题 🔐

**问题：** 可能没有查看工作流的权限。

**解决方案：检查权限**

1. **确认仓库是 Public 或您有访问权限**
   - GitHub Pages 免费版需要 Public 仓库
   - 或者您需要有仓库的写入权限

2. **检查组织设置（如果是组织仓库）**
   - 如果是组织仓库，检查组织的 Actions 设置
   - 确保允许运行工作流

---

## 完整排查步骤

### 步骤 1: 验证文件存在 ✅

1. 进入 GitHub 仓库
2. 导航到 `.github/workflows/deploy.yml`
3. **确认文件存在且内容正确**

---

### 步骤 2: 检查 Actions 标签 🔍

1. 进入 **Actions** 标签
2. **检查左侧工作流列表**
   - 应该能看到 "Deploy to GitHub Pages"
   - 如果看不到，说明 GitHub 还没识别到文件

3. **如果能看到工作流：**
   - 点击进入
   - 查看是否有运行记录
   - 如果没有，点击 **"Run workflow"** 手动触发

---

### 步骤 3: 手动触发工作流 🚀

**这是最关键的步骤！**

1. **进入 Actions 标签**
2. **找到 "Deploy to GitHub Pages" 工作流**
3. **点击进入工作流页面**
4. **点击右上角的 "Run workflow"**
5. **选择分支（main）**
6. **点击绿色的 "Run workflow" 按钮**
7. **等待运行完成**（1-3 分钟）

---

### 步骤 4: 刷新 Pages 设置 🔄

1. **等待工作流运行完成**（看到绿色 ✓）
2. **进入 Settings → Pages**
3. **点击 "Browse all workflows"**
4. **现在应该能看到 "Deploy to GitHub Pages"**

---

### 步骤 5: 如果仍然找不到 ⚠️

**尝试以下方法：**

**方法 A: 检查工作流名称**
- 工作流名称是 `name: Deploy to GitHub Pages`
- 确保名称中没有特殊字符或错误

**方法 B: 重新创建文件**
- 在 GitHub 网页上删除现有的 `deploy.yml`
- 重新创建文件（使用相同内容）
- 提交并推送

**方法 C: 使用不同的工作流名称**
- 修改 `deploy.yml` 中的 `name:` 字段
- 例如改为：`name: GitHub Pages Deployment`
- 提交并推送
- 手动触发一次

---

## 快速修复方案

### 方案 1: 直接使用 Actions 部署（推荐）

如果找不到工作流，可以直接在 Actions 中触发：

1. **进入 Actions 标签**
2. **找到 "Deploy to GitHub Pages" 工作流**
3. **手动运行一次**
4. **运行成功后，GitHub Pages 会自动部署**

**注意：** 即使 Pages 设置中找不到工作流，只要 Actions 能运行，部署就会成功！

---

### 方案 2: 检查工作流文件内容

确保 `deploy.yml` 文件包含以下关键部分：

```yaml
name: Deploy to GitHub Pages  # ← 这个名称会显示在 Pages 设置中

on:
  push:
    branches:
      - main
  workflow_dispatch:  # ← 这个允许手动触发

jobs:
  build:
    # ... 构建步骤
  deploy:
    environment:
      name: github-pages  # ← 这个很重要，必须匹配
```

---

## 验证清单

完成上述步骤后，检查：

- [ ] `.github/workflows/deploy.yml` 文件在 GitHub 上存在
- [ ] 文件内容正确（没有语法错误）
- [ ] 进入 **Actions** 标签，能看到 "Deploy to GitHub Pages" 工作流
- [ ] 工作流至少运行过一次（手动或自动）
- [ ] 工作流运行成功（绿色 ✓）
- [ ] 进入 **Settings** → **Pages** → "Browse all workflows"，能看到工作流
- [ ] 可以选择工作流并保存

---

## 如果所有方法都失败

### 最后手段：直接在 Pages 设置中选择

如果 "Browse all workflows" 中确实找不到，但 Actions 中能看到：

1. **确认工作流在 Actions 中能正常运行**
2. **在 Pages 设置中，尝试：**
   - 选择 **"GitHub Actions"** 作为源
   - 如果看到下拉菜单，直接选择（即使列表为空）
   - 保存设置
   - GitHub 会自动使用最近运行的工作流

---

## 总结

**最可能的原因：**
1. ⏰ 工作流从未运行过（需要手动触发一次）
2. 🔧 GitHub Actions 未正确启用
3. ⏱️ GitHub 需要时间识别新文件

**推荐操作顺序：**
1. ✅ 进入 **Actions** 标签，查找工作流
2. ✅ 手动触发工作流一次
3. ✅ 等待运行完成
4. ✅ 刷新 **Pages** 设置页面
5. ✅ 再次点击 "Browse all workflows"

**关键提示：** 即使 Pages 设置中找不到，只要 Actions 能运行工作流，部署就会成功！您可以先让工作流运行一次，然后再检查 Pages 设置。

---

**创建时间：** 2024年12月  
**状态：** ✅ 排查指南已创建
