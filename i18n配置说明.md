# i18n 配置说明

## 修改内容

已更新 `i18n/request.ts` 文件，使其能够**自动扫描** `messages/[locale]/` 目录下的所有 JSON 文件，而不再需要硬编码文件列表。

## 主要改动

### 之前（硬编码文件列表）
```typescript
const translationFiles = ['index', 'about', 'products', 'contact', 'faq'];

for (const file of translationFiles) {
  const fileMessages = await import(`../messages/${locale}/${file}.json`);
  messages[file] = fileMessages.default;
}
```

### 现在（自动扫描目录）
```typescript
import {readdirSync} from 'fs';
import {join} from 'path';

// 获取 messages 目录的绝对路径
const messagesDir = join(process.cwd(), 'messages', locale);

// 读取目录下的所有文件
const files = readdirSync(messagesDir);

// 过滤出 .json 文件并提取文件名（去掉扩展名）
const jsonFiles = files
  .filter(file => file.endsWith('.json'))
  .map(file => file.replace(/\.json$/, ''));

// 动态加载所有 JSON 文件
for (const fileName of jsonFiles) {
  const fileMessages = await import(`../messages/${locale}/${fileName}.json`);
  messages[fileName] = fileMessages.default || fileMessages;
}
```

## 功能特点

1. ✅ **自动扫描**：自动读取 `messages/[locale]/` 目录下的所有 `.json` 文件
2. ✅ **无需维护列表**：添加新的翻译文件时，无需修改代码
3. ✅ **文件名作为命名空间**：JSON 文件名（去掉 `.json` 扩展名）自动成为命名空间键
4. ✅ **错误处理**：如果某个文件加载失败，会记录警告但继续处理其他文件
5. ✅ **向后兼容**：现有的翻译文件和使用方式完全兼容

## 使用示例

假设 `messages/en/` 目录下有以下文件：
- `index.json`
- `about.json`
- `products.json`
- `contact.json`
- `faq.json`
- `common.json` （新添加的文件）

代码会自动加载所有这些文件，并创建以下命名空间：
- `index`
- `about`
- `products`
- `contact`
- `faq`
- `common` （自动加载）

在代码中使用：
```typescript
const t = useTranslations('common'); // 直接使用，无需修改配置
```

## 注意事项

1. **文件命名**：JSON 文件名应该使用小写字母和连字符，避免使用特殊字符
2. **命名空间冲突**：确保每个文件有唯一的文件名
3. **文件格式**：所有文件必须是有效的 JSON 格式
4. **构建时打包**：Next.js 的 webpack 会在构建时分析动态导入路径，确保所有文件都被正确打包

## 技术说明

- 使用 Node.js 的 `fs.readdirSync` 在服务器端读取目录
- 使用动态 `import()` 加载翻译文件
- 文件名（去掉扩展名）自动成为命名空间键
- 错误处理确保单个文件失败不会影响其他文件的加载

## 测试建议

1. 添加一个新的 JSON 文件（如 `messages/en/common.json`）
2. 在代码中使用 `useTranslations('common')`
3. 验证翻译是否正确加载
4. 检查控制台是否有警告或错误信息

