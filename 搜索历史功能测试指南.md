# 搜索历史功能测试指南

## 🧪 测试步骤

### 1. 基础功能测试

#### 测试 1.1：保存搜索历史
1. 打开网站
2. 点击导航栏搜索图标（或按 `Ctrl/Cmd + K`）
3. 输入搜索关键词（如 "Nexus"）
4. 等待搜索结果出现
5. **预期结果**：搜索历史应该自动保存

#### 测试 1.2：查看搜索历史
1. 关闭搜索框
2. 再次打开搜索框
3. 不输入任何内容
4. **预期结果**：应该显示"最近搜索"部分，包含刚才的搜索

#### 测试 1.3：使用历史搜索
1. 在搜索历史列表中，点击任意一条历史记录
2. **预期结果**：
   - 搜索框自动填充该关键词
   - 自动执行搜索
   - 显示搜索结果

---

### 2. 历史管理测试

#### 测试 2.1：删除单条历史
1. 打开搜索框
2. 查看搜索历史
3. 点击某条历史记录右侧的 X 按钮
4. **预期结果**：
   - 该条历史记录立即消失
   - 其他历史记录保持不变

#### 测试 2.2：清除所有历史
1. 打开搜索框
2. 查看搜索历史
3. 点击"清除"按钮（带垃圾桶图标）
4. **预期结果**：
   - 所有历史记录消失
   - 显示热门搜索（如果有）

---

### 3. 边界情况测试

#### 测试 3.1：重复搜索
1. 搜索 "Nexus"
2. 再次搜索 "Nexus"
3. **预期结果**：
   - 历史记录中只有一条 "Nexus"
   - 该条记录移动到最前面（最新）

#### 测试 3.2：历史记录数量限制
1. 执行 25 次不同的搜索
2. **预期结果**：
   - 历史记录最多保存 20 条
   - 最旧的记录被删除

#### 测试 3.3：显示数量限制
1. 确保有超过 10 条搜索历史
2. 打开搜索框查看历史
3. **预期结果**：
   - 只显示最新的 10 条历史
   - 但实际保存了更多（最多 20 条）

---

### 4. 数据持久化测试

#### 测试 4.1：刷新页面
1. 执行几次搜索
2. 刷新页面（F5）
3. 打开搜索框
4. **预期结果**：历史记录仍然存在

#### 测试 4.2：关闭浏览器
1. 执行几次搜索
2. 关闭浏览器
3. 重新打开浏览器和网站
4. 打开搜索框
5. **预期结果**：历史记录仍然存在（localStorage 持久化）

---

### 5. 交互测试

#### 测试 5.1：搜索历史显示条件
1. **场景 1**：无搜索历史
   - 打开搜索框，不输入
   - **预期**：显示热门搜索

2. **场景 2**：有搜索历史
   - 执行几次搜索
   - 打开搜索框，不输入
   - **预期**：显示搜索历史（不显示热门搜索）

3. **场景 3**：有输入
   - 打开搜索框
   - 输入 2 个或更多字符
   - **预期**：显示搜索建议（不显示历史）

#### 测试 5.2：搜索结果数量显示
1. 执行搜索
2. 查看搜索历史
3. **预期结果**：历史记录显示搜索结果数量（如 "5 results"）

---

## 🔍 浏览器控制台测试

### 手动测试 localStorage

打开浏览器开发者工具（F12），在控制台中执行：

```javascript
// 查看搜索历史
JSON.parse(localStorage.getItem('isperm_search_history'))

// 手动添加测试数据
localStorage.setItem('isperm_search_history', JSON.stringify([
  { query: 'Test 1', timestamp: Date.now(), resultCount: 10 },
  { query: 'Test 2', timestamp: Date.now() - 1000, resultCount: 5 }
]))

// 清除搜索历史
localStorage.removeItem('isperm_search_history')
```

---

## ✅ 预期行为总结

### 正常行为
- ✅ 每次搜索后自动保存
- ✅ 历史记录按时间倒序排列（最新的在前）
- ✅ 重复搜索会移动到最前面
- ✅ 最多保存 20 条历史
- ✅ 最多显示 10 条历史
- ✅ 数据持久化到 localStorage
- ✅ 显示搜索结果数量

### 异常处理
- ✅ 如果 localStorage 不可用，不会报错
- ✅ 如果数据损坏，不会影响搜索功能
- ✅ 清除历史后，显示热门搜索

---

## 🐛 已知问题和注意事项

### 注意事项
1. **浏览器隐私模式**：在隐私模式下，localStorage 可能被限制
2. **跨域问题**：不同域名之间的 localStorage 是隔离的
3. **存储限制**：localStorage 通常有 5-10MB 限制（搜索历史远小于此）

### 潜在问题
1. **点击历史记录**：使用了 `onMouseDown` 和 `setTimeout`，可能需要优化
2. **大小写敏感**：搜索历史比较时使用 `toLowerCase()`，应该没问题

---

## 📊 测试检查清单

- [ ] 保存搜索历史
- [ ] 查看搜索历史
- [ ] 使用历史搜索
- [ ] 删除单条历史
- [ ] 清除所有历史
- [ ] 重复搜索处理
- [ ] 历史数量限制（20条）
- [ ] 显示数量限制（10条）
- [ ] 页面刷新后历史保留
- [ ] 浏览器关闭后历史保留
- [ ] 搜索结果数量显示
- [ ] 显示优先级（建议 > 历史 > 热门）

---

## 🚀 快速测试脚本

在浏览器控制台中运行以下代码进行快速测试：

```javascript
// 测试搜索历史功能
function testSearchHistory() {
  console.log('=== 搜索历史功能测试 ===');
  
  // 1. 测试保存
  console.log('1. 测试保存功能...');
  // 需要在实际搜索后测试
  
  // 2. 测试读取
  console.log('2. 测试读取功能...');
  const history = JSON.parse(localStorage.getItem('isperm_search_history') || '[]');
  console.log('当前历史记录数:', history.length);
  console.log('历史记录:', history);
  
  // 3. 测试清除
  console.log('3. 测试清除功能...');
  // localStorage.removeItem('isperm_search_history');
  // console.log('已清除历史记录');
  
  console.log('=== 测试完成 ===');
}

// 运行测试
testSearchHistory();
```

---

**测试完成后，请确认所有功能正常工作！**
