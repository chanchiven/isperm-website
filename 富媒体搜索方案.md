# 富媒体搜索功能实现方案

## 一、方案概述

为 iSperm Medical 网站实现富媒体搜索功能，支持搜索图片、产品、文章等多媒体内容，提升用户体验和内容发现能力。

## 二、功能需求

### 2.1 搜索范围
1. **图片搜索**
   - 产品图片（Nexus DX1, MSQA-100, SQA-6100Vet）
   - FAQ 文章配图
   - 关于页面展示图片
   - 基于 alt 文本、文件名、关联内容搜索

2. **产品搜索**
   - 产品名称、描述
   - 产品图片
   - 产品特性、应用场景

3. **文章搜索**
   - FAQ 文章标题、内容
   - 文章配图
   - 文章分类（人类/兽医）

4. **页面搜索**
   - 首页、关于、联系等页面内容

### 2.2 搜索功能特性
- ✅ 多语言支持（18种语言）
- ✅ 实时搜索建议
- ✅ 搜索结果分类展示（图片、产品、文章）
- ✅ 搜索结果高亮
- ✅ 图片预览
- ✅ 响应式设计

## 三、技术方案

### 3.1 架构设计

```
搜索功能架构
├── 搜索索引构建（构建时）
│   ├── 图片索引（alt、文件名、关联内容）
│   ├── 产品索引（名称、描述、图片）
│   ├── 文章索引（标题、内容、图片）
│   └── 页面索引（内容、元数据）
│
├── 搜索 API（运行时）
│   ├── /api/search - 统一搜索接口
│   └── 支持多语言、多类型搜索
│
└── 搜索 UI 组件
    ├── SearchBar - 搜索输入框
    ├── SearchResults - 搜索结果展示
    └── SearchModal - 搜索模态框
```

### 3.2 数据索引结构

#### 图片索引
```typescript
interface ImageIndex {
  id: string;
  src: string;
  alt: string; // 多语言
  filename: string;
  type: 'product' | 'article' | 'about' | 'banner';
  associatedContent: {
    type: 'product' | 'article' | 'page';
    id: string;
    title: string; // 多语言
    url: string;
  };
  locale: string;
}
```

#### 产品索引
```typescript
interface ProductIndex {
  id: string;
  slug: string;
  name: string; // 多语言
  description: string; // 多语言
  images: string[];
  features: string[]; // 多语言
  locale: string;
}
```

#### 文章索引
```typescript
interface ArticleIndex {
  id: string;
  slug: string;
  title: string; // 多语言
  subtitle: string; // 多语言
  content: string; // 多语言（简化版）
  image: string;
  category: 'human' | 'veterinary';
  locale: string;
}
```

### 3.3 搜索算法

#### 3.3.1 文本匹配
- 使用模糊匹配（Fuse.js 或自定义算法）
- 支持关键词分词
- 多语言分词支持

#### 3.3.2 相关性排序
1. **精确匹配** - 最高优先级
2. **标题匹配** - 高优先级
3. **内容匹配** - 中优先级
4. **Alt 文本匹配** - 中优先级
5. **文件名匹配** - 低优先级

### 3.4 实现步骤

#### 阶段一：搜索索引构建
1. 创建索引构建脚本 `scripts/build-search-index.ts`
2. 扫描所有图片、产品、文章
3. 提取元数据和关联信息
4. 生成 JSON 索引文件

#### 阶段二：搜索 API
1. 创建 `/app/api/search/route.ts`
2. 实现搜索逻辑
3. 支持多语言、多类型过滤
4. 返回结构化结果

#### 阶段三：搜索 UI
1. 创建 `components/SearchBar.tsx`
2. 创建 `components/SearchResults.tsx`
3. 创建 `components/SearchModal.tsx`
4. 集成到导航栏

#### 阶段四：优化与增强
1. 搜索建议/自动完成
2. 搜索历史
3. 热门搜索
4. 无结果优化

## 四、文件结构

```
isperm-website/
├── app/
│   ├── api/
│   │   └── search/
│   │       └── route.ts          # 搜索 API
│   └── [locale]/
│       └── search/
│           └── page.tsx          # 搜索结果页面
│
├── components/
│   ├── SearchBar.tsx             # 搜索输入框组件
│   ├── SearchResults.tsx         # 搜索结果展示组件
│   ├── SearchModal.tsx           # 搜索模态框组件
│   └── SearchResultCard.tsx     # 单个搜索结果卡片
│
├── lib/
│   ├── search/
│   │   ├── index.ts              # 搜索索引类型定义
│   │   ├── search.ts             # 搜索核心逻辑
│   │   └── indexer.ts            # 索引构建工具
│   └── utils/
│       └── text-matching.ts      # 文本匹配工具
│
├── public/
│   └── search-index/
│       └── [locale]/
│           └── index.json        # 搜索索引文件（按语言）
│
└── scripts/
    └── build-search-index.ts     # 索引构建脚本
```

## 五、多语言支持

### 5.1 翻译键
在 `messages/[locale]/search.json` 中添加：
```json
{
  "placeholder": "搜索产品、文章、图片...",
  "noResults": "未找到结果",
  "results": {
    "products": "产品",
    "articles": "文章",
    "images": "图片",
    "pages": "页面"
  },
  "suggestions": "搜索建议",
  "recent": "最近搜索",
  "popular": "热门搜索"
}
```

### 5.2 索引文件
为每种语言生成独立的索引文件，确保搜索结果与用户语言匹配。

## 六、UI/UX 设计

### 6.1 搜索入口
- 导航栏搜索图标/输入框
- 支持键盘快捷键（Ctrl/Cmd + K）
- 移动端友好的搜索按钮

### 6.2 搜索结果展示
- **分类标签**：产品、文章、图片、页面
- **结果卡片**：图片预览、标题、描述、链接
- **高亮显示**：匹配关键词高亮
- **加载状态**：骨架屏或加载动画

### 6.3 交互设计
- 实时搜索（防抖处理）
- 键盘导航支持
- 点击外部关闭搜索
- 移动端优化

## 七、性能优化

### 7.1 索引优化
- 索引文件压缩
- 按需加载索引
- 索引缓存策略

### 7.2 搜索优化
- 防抖处理（300ms）
- 结果分页
- 虚拟滚动（大量结果时）

### 7.3 图片优化
- 搜索结果使用缩略图
- 懒加载
- WebP 格式

## 八、SEO 优化

### 8.1 Schema.org 标记
更新 `app/layout.tsx` 中的 SearchAction：
```json
{
  "@type": "SearchAction",
  "target": {
    "@type": "EntryPoint",
    "urlTemplate": "https://www.isperm.com/{locale}/search?q={search_term_string}"
  },
  "query-input": "required name=search_term_string"
}
```

### 8.2 搜索结果页面 SEO
- 动态 meta 标签
- 结构化数据
- 友好的 URL 结构

## 九、实施优先级

### 高优先级（MVP）
1. ✅ 基础搜索功能（文本搜索）
2. ✅ 产品、文章搜索
3. ✅ 搜索结果页面
4. ✅ 多语言支持

### 中优先级
1. 图片搜索
2. 搜索建议
3. 搜索历史
4. 结果分类

### 低优先级（增强）
1. 视觉搜索（图片相似度）
2. 高级筛选
3. 搜索分析
4. 个性化推荐

## 十、技术选型

### 搜索库
- **Fuse.js** - 轻量级模糊搜索（推荐）
- **Lunr.js** - 全文搜索（备选）
- **自定义算法** - 简单场景（备选）

### 依赖包
```json
{
  "fuse.js": "^7.0.0",
  "lodash.debounce": "^4.0.8"
}
```

## 十一、测试计划

### 11.1 功能测试
- [ ] 搜索产品名称
- [ ] 搜索文章标题
- [ ] 搜索图片 alt 文本
- [ ] 多语言搜索
- [ ] 空结果处理
- [ ] 特殊字符处理

### 11.2 性能测试
- [ ] 搜索响应时间 < 200ms
- [ ] 索引文件大小 < 500KB/语言
- [ ] 移动端性能

### 11.3 兼容性测试
- [ ] 浏览器兼容性
- [ ] 移动端适配
- [ ] 键盘导航

## 十二、后续扩展

### 12.1 高级功能
- 视觉搜索（图片相似度匹配）
- AI 语义搜索
- 语音搜索
- 搜索分析统计

### 12.2 集成方案
- Google Custom Search
- Algolia Search
- Elasticsearch（大规模场景）

---

## 实施建议

1. **先实现 MVP**：基础文本搜索 + 产品/文章搜索
2. **逐步增强**：添加图片搜索、搜索建议等
3. **性能监控**：关注搜索响应时间和索引大小
4. **用户反馈**：收集用户使用反馈，持续优化

---

**文档版本**: v1.0  
**创建日期**: 2024  
**最后更新**: 2024
